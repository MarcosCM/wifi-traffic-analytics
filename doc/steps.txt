Install OpenWRT:
- Download OpenWRT 15.05.1 Chaos Calmer image for Raspberry Pi 2: https://downloads.openwrt.org/chaos_calmer/15.05.1/brcm2708/bcm2709/openwrt-15.05.1-brcm2708-bcm2709-sdcard-vfat-ext4.img
- Download Win32DiskImager: https://sourceforge.net/projects/win32diskimager/
- Insert the SD Card and flash the image
- Safely eject the SD Card

Boot the Raspberry:
- Insert the SD Card in the Raspberry
- Connect the electric supply to the Raspberry
- Connect the PC to the Raspberry via Ethernet
- Open a web browser and connect to 192.168.1.1 (user: root; blank password)
- Configure a new password to access the Raspberry not only through LuCI (web interface) but also SSH: System -> Administration -> (Set new PW) -> Save & Apply

Change the network config and install Alfa card & USB drivers:
- SSH into the Raspberry
- Set new IP, mask, gateway and DNS of interface to match the network requirements and disable DHCP & DHCPv6

    (/etc/config/network)
    config interface 'lan'
        option ifname 'eth0'
        option type 'bridge'
        option proto 'static'
        option ipaddr '155.210.155.183'
        option netmask '255.255.255.0'
        option gateway '155.210.155.254'
        option ip6assign '60'
        list dns '8.8.8.8'

    (/etc/config/dhcp)
    config dhcp 'lan'
        option interface 'lan'
        option ignore '1'

- Reboot the Raspberry
- Connect the Raspberry to the router via Ethernet
- Connect the PC to the router
- SSH into the Raspberry
- opkg update
- opkg install kmod-rt2800-lib kmod-rt2800-usb kmod-rt2x00-lib kmod-rt2x00-usb
- opkg install kmod-usb-core kmod-usb-ohci kmod-usb-uhci kmod-usb2 usbutils
- opkg install iwinfo
- opkg install hostapd wpa-supplicant
- reboot
- Connect the Alfa to the Raspberry and to the PC via USB
- wifi detect > /etc/config/wireless
- Set wifi settings: 0 dBm (1 mW), channel, etc and enable wifi (to modify these settings through LuCI web interface, there must be a '/etc/config/wireless' file in order the menu option to show up. Fastest way is: 'wifi detect > /etc/config/wireless').

    (/etc/config/wireless)
    config wifi-device 'radio0'
        option type 'mac80211'
        option channel '11'
        option hwmode '11g'
        option path 'platform/bcm2708_usb/usb1/1-1/1-1.3/1-1.3:1.0'
        option txpower '0'
        option country 'ES'
        option htmode 'HT20'

    config wifi-iface
        option device 'radio0'
        option network 'lan'
        option mode 'ap'
        option encryption 'none'
        option ssid 'SEUtest'

**HINT**: 'option path' depends on which USB port the Alfa card is connected to, so don't connect it to other USB port in future boots. Otherwise, remove '/etc/config/wireless' and 'wifi detect > /etc/config/wireless' again to know which USB port it is connected to.

- wifi up
- If wifi is not enabled or shown up in 5 seconds then 'wifi up' again. If this happens, it must only happen one or two times, because of failing to read either '/var/run/wifi-phyX.pid' or '/var/run/hostapd-phyX.conf' (otherwise any of the previous steps has been wrongly done).
**HINT**: There's not a LuCI web option to make the antenna start providing wifi access, it must be done through the previous SSH command.

Configure alfa adapter in station to connect to the wifi network:
- iw dev wlan1 set type managed
- iw dev wlan1 set txpower fixed 0
- iw dev wlan1 set channel 11
- iw dev wlan1 info

Configure alfa adapter in station to monitor the over-the-air traffic:
- ifconfig wlan2 down
- iw dev wlan2 set type monitor
- iw dev wlan2 set txpower fixed 0
- iw dev wlan2 set channel 11
- ifconfig wlan2 up

**HINT**: if channel width is changed in the AP, then it must also be changed in the STA, try either:
- iw dev wlan1 set channel 11 HT40-
or
- iw dev wlan1 set channel 11 HT40+
To return to default mode:
- iw dev wlan1 set channel 11 HT20

Adapter current is not updated until something is connected to its wifi network or it's connected to a wifi network.
To check adapter current, test these two commands:
- iwinfo wlan0 info
- iwlist wlan0 txpower
If current is not updated taken these conditions, then automatic power saving may be enabled. To disable this then try:
- iw dev wlan1 set power_save off
Then repeat the first steps (change txpower, make the antenna be connected to something and verify txpower is updated)

Connect and capture frames in Wireshark:
- Connect the Alfa adapter card to the PC
- sudo iw dev wlan1 interface add mon1 type monitor
- sudo ifconfig mon1 up
- Connect to the WiFi network
- sudo wireshark
- Configure interface mon1 to capture in promiscuous mode

Analyze capture:
- Open capture in Wiresghark
- Filter packets by 'radiotap.dbm_antsignal'
- File -> Export Packet Dissections -> as "CSV" -> All packets (Displayed)
- Open csvToMat.m and change the column indexes of the variables to match the exported CSV columns order.